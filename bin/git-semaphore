#!/usr/bin/env ruby

$LOAD_PATH.unshift File.join(File.dirname(__FILE__), '..', 'lib')

begin
  require 'git-semaphore'
rescue LoadError
  require 'rubygems'
  require 'git-semaphore'
end

options = Trollop::options do
  version Git::Semaphore::COPYRIGHT
  banner Git::Semaphore::BANNER
  opt :'working-dir', 'Print working dir', :short => 'w', :default => false
  opt :'check-auth', 'Check auth token', :short => 'a', :default => false
  opt :'check-project', 'Check project token', :short => 'p', :default => false
  opt :'print-config', 'Print config', :short => 'c', :default => false
end

app = Git::Semaphore::App.new(ENV)

if options[:'working-dir']
  puts Dir.pwd
  exit 0
end

if options[:'check-auth']
  unless app.auth_token
    STDERR.puts 'Please set (and export) the SEMAPHORE_AUTH_TOKEN env var...'
    exit -1
  else
    exit 0
  end
end

if options[:'check-project']
  unless app.project_token
    STDERR.puts 'Please set (and export) the SEMAPHORE_PROJECT_TOKEN env var...'
    exit -1
  else
    exit 0
  end
end

if options[:'print-config']
  puts "export SEMAPHORE_AUTH_TOKEN=\"#{app.auth_token}\""
  puts "export SEMAPHORE_PROJECT_TOKEN=\"#{app.project_token}\""
  exit 0
end

fail "Coming soon!"

# That's all, Folks!
